{"ast":null,"code":"\"use strict\";\n\nvar _createClass = require(\"/home/hishamak/Desktop/mhak-react/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\nvar _get = require(\"/home/hishamak/Desktop/mhak-react/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/get\");\nvar _classCallCheck = require(\"/home/hishamak/Desktop/mhak-react/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\nvar _possibleConstructorReturn = require(\"/home/hishamak/Desktop/mhak-react/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/possibleConstructorReturn\");\nvar _getPrototypeOf = require(\"/home/hishamak/Desktop/mhak-react/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/getPrototypeOf\");\nvar _inherits = require(\"/home/hishamak/Desktop/mhak-react/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.NodePlatformFunctions = void 0;\nvar crypto = require(\"crypto\");\nvar events_1 = require(\"events\");\nvar NodeCryptoProvider_js_1 = require(\"../crypto/NodeCryptoProvider.js\");\nvar NodeHttpClient_js_1 = require(\"../net/NodeHttpClient.js\");\nvar PlatformFunctions_js_1 = require(\"./PlatformFunctions.js\");\nvar Error_js_1 = require(\"../Error.js\");\nvar utils_js_1 = require(\"../utils.js\");\nvar child_process_1 = require(\"child_process\");\nvar StreamProcessingError = /*#__PURE__*/function (_Error_js_1$StripeErr) {\n  _inherits(StreamProcessingError, _Error_js_1$StripeErr);\n  function StreamProcessingError() {\n    _classCallCheck(this, StreamProcessingError);\n    return _possibleConstructorReturn(this, _getPrototypeOf(StreamProcessingError).apply(this, arguments));\n  }\n  return StreamProcessingError;\n}(Error_js_1.StripeError);\n/**\n * Specializes WebPlatformFunctions using APIs available in Node.js.\n */\nvar NodePlatformFunctions = /*#__PURE__*/function (_PlatformFunctions_js) {\n  _inherits(NodePlatformFunctions, _PlatformFunctions_js);\n  function NodePlatformFunctions() {\n    var _this;\n    _classCallCheck(this, NodePlatformFunctions);\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(NodePlatformFunctions).call(this));\n    _this._exec = child_process_1.exec;\n    _this._UNAME_CACHE = null;\n    return _this;\n  }\n  /** @override */\n  _createClass(NodePlatformFunctions, [{\n    key: \"uuid4\",\n    value: function uuid4() {\n      // available in: v14.17.x+\n      if (crypto.randomUUID) {\n        return crypto.randomUUID();\n      }\n      return _get(_getPrototypeOf(NodePlatformFunctions.prototype), \"uuid4\", this).call(this);\n    }\n    /**\n     * @override\n     * Node's built in `exec` function sometimes throws outright,\n     * and sometimes has a callback with an error,\n     * depending on the type of error.\n     *\n     * This unifies that interface by resolving with a null uname\n     * if an error is encountered.\n     */\n  }, {\n    key: \"getUname\",\n    value: function getUname() {\n      var _this2 = this;\n      if (!this._UNAME_CACHE) {\n        this._UNAME_CACHE = new Promise(function (resolve, reject) {\n          try {\n            _this2._exec('uname -a', function (err, uname) {\n              if (err) {\n                return resolve(null);\n              }\n              resolve(uname);\n            });\n          } catch (e) {\n            resolve(null);\n          }\n        });\n      }\n      return this._UNAME_CACHE;\n    }\n    /**\n     * @override\n     * Secure compare, from https://github.com/freewil/scmp\n     */\n  }, {\n    key: \"secureCompare\",\n    value: function secureCompare(a, b) {\n      if (!a || !b) {\n        throw new Error('secureCompare must receive two arguments');\n      }\n      // return early here if buffer lengths are not equal since timingSafeEqual\n      // will throw if buffer lengths are not equal\n      if (a.length !== b.length) {\n        return false;\n      }\n      // use crypto.timingSafeEqual if available (since Node.js v6.6.0),\n      // otherwise use our own scmp-internal function.\n      if (crypto.timingSafeEqual) {\n        var textEncoder = new TextEncoder();\n        var aEncoded = textEncoder.encode(a);\n        var bEncoded = textEncoder.encode(b);\n        return crypto.timingSafeEqual(aEncoded, bEncoded);\n      }\n      return _get(_getPrototypeOf(NodePlatformFunctions.prototype), \"secureCompare\", this).call(this, a, b);\n    }\n  }, {\n    key: \"createEmitter\",\n    value: function createEmitter() {\n      return new events_1.EventEmitter();\n    } /** @override */\n  }, {\n    key: \"tryBufferData\",\n    value: function tryBufferData(data) {\n      if (!(data.file.data instanceof events_1.EventEmitter)) {\n        return Promise.resolve(data);\n      }\n      var bufferArray = [];\n      return new Promise(function (resolve, reject) {\n        data.file.data.on('data', function (line) {\n          bufferArray.push(line);\n        }).once('end', function () {\n          // @ts-ignore\n          var bufferData = Object.assign({}, data);\n          bufferData.file.data = (0, utils_js_1.concat)(bufferArray);\n          resolve(bufferData);\n        }).on('error', function (err) {\n          reject(new StreamProcessingError({\n            message: 'An error occurred while attempting to process the file for upload.',\n            detail: err\n          }));\n        });\n      });\n    } /** @override */\n  }, {\n    key: \"createNodeHttpClient\",\n    value: function createNodeHttpClient(agent) {\n      return new NodeHttpClient_js_1.NodeHttpClient(agent);\n    } /** @override */\n  }, {\n    key: \"createDefaultHttpClient\",\n    value: function createDefaultHttpClient() {\n      return new NodeHttpClient_js_1.NodeHttpClient();\n    } /** @override */\n  }, {\n    key: \"createNodeCryptoProvider\",\n    value: function createNodeCryptoProvider() {\n      return new NodeCryptoProvider_js_1.NodeCryptoProvider();\n    } /** @override */\n  }, {\n    key: \"createDefaultCryptoProvider\",\n    value: function createDefaultCryptoProvider() {\n      return this.createNodeCryptoProvider();\n    }\n  }]);\n  return NodePlatformFunctions;\n}(PlatformFunctions_js_1.PlatformFunctions);\nexports.NodePlatformFunctions = NodePlatformFunctions;","map":null,"metadata":{},"sourceType":"script"}